{% extends '@EasyAdmin/generic/widgets/form_group.html.twig' %}

{% block field_widget %}
    <div class="viz-config-container">
        {% if ea.crud.currentAction == 'detail' %}
            <div class="card">
                <div class="card-body">
                    {% if field.value %}
                        <dl class="row">
                            <dt class="col-sm-3">Dataset</dt>
                            <dd class="col-sm-9">{{ field.value.dataset_id }}</dd>

                            <dt class="col-sm-3">Type</dt>
                            <dd class="col-sm-9">{{ field.value.type }}</dd>

                            <dt class="col-sm-3">Axe X</dt>
                            <dd class="col-sm-9">{{ field.value.axe_x }}</dd>

                            <dt class="col-sm-3">Axe Y</dt>
                            <dd class="col-sm-9">{{ field.value.axe_y }}</dd>

                            <dt class="col-sm-3">Couleur</dt>
                            <dd class="col-sm-9">
                                <span style="display: inline-block; width: 30px; height: 30px; background-color: {{ field.value.couleur }}; border: 1px solid #ccc; border-radius: 4px;"></span>
                                {{ field.value.couleur }}
                            </dd>

                            {% if field.value.titre %}
                                <dt class="col-sm-3">Titre</dt>
                                <dd class="col-sm-9">{{ field.value.titre }}</dd>
                            {% endif %}
                        </dl>
                    {% else %}
                        <p class="text-muted">Aucune configuration de graphique</p>
                    {% endif %}
                </div>
            </div>
        {% else %}
            {# Affichage du formulaire #}
            <div id="viz-config-form" class="card">
                <div class="card-header">
                    <h5 class="card-title">Configuration du Graphique</h5>
                </div>
                <div class="card-body">
                    <div class="form-group">
                        <label for="dataset_id" class="form-label">Dataset</label>
                        <select id="dataset_id" name="block[vizConfig][dataset_id]" class="form-control">
                            <option value="">-- Sélectionnez un dataset --</option>
                            {% for dataset in datasets %}
                                <option value="{{ dataset.id }}" {% if field.value.dataset_id == dataset.id %}selected{% endif %}>
                                    {{ dataset.name }}
                                </option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="type" class="form-label">Type de graphique</label>
                        <select id="type" name="block[vizConfig][type]" class="form-control">
                            <option value="">-- Sélectionnez un type --</option>
                            <option value="bar" {% if field.value.type == 'bar' %}selected{% endif %}>Barres</option>
                            <option value="line" {% if field.value.type == 'line' %}selected{% endif %}>Ligne</option>
                            <option value="pie" {% if field.value.type == 'pie' %}selected{% endif %}>Pie/Donut</option>
                            <option value="scatter" {% if field.value.type == 'scatter' %}selected{% endif %}>Scatter</option>
                        </select>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="axe_x" class="form-label">Colonne pour l'axe X</label>
                                <input type="text" id="axe_x" name="block[vizConfig][axe_x]" class="form-control" 
                                       value="{{ field.value.axe_x }}" placeholder="Ex: mois, date, catégorie">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="axe_y" class="form-label">Colonne pour l'axe Y</label>
                                <input type="text" id="axe_y" name="block[vizConfig][axe_y]" class="form-control" 
                                       value="{{ field.value.axe_y }}" placeholder="Ex: ventes, température, prix">
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="couleur" class="form-label">Couleur principale</label>
                                <input type="color" id="couleur" name="block[vizConfig][couleur]" class="form-control form-control-color" 
                                       value="{{ field.value.couleur }}">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="titre" class="form-label">Titre du graphique (optionnel)</label>
                                <input type="text" id="titre" name="block[vizConfig][titre]" class="form-control" 
                                       value="{{ field.value.titre }}" placeholder="Ex: Évolution des ventes 2024">
                            </div>
                        </div>
                    </div>

                    <div class="alert alert-info mt-3">
                        <strong>Aide:</strong>
                        <ul class="mb-0 mt-2">
                            <li><strong>Dataset:</strong> Sélectionnez la source de données pour votre graphique</li>
                            <li><strong>Type:</strong> Choisissez la forme du graphique (barres, ligne, etc.)</li>
                            <li><strong>Axes:</strong> Indiquez les noms des colonnes à afficher</li>
                            <li><strong>Couleur:</strong> Définissez la couleur principale du graphique</li>
                        </ul>
                    </div>
                </div>
            </div>
        {% endif %}
    </div>

    <style>
        .viz-config-container .card {
            margin-top: 1rem;
        }
        .viz-config-container .form-group {
            margin-bottom: 1rem;
        }
        .viz-config-container .form-control-color {
            height: auto;
            padding: 0.375rem 0.75rem;
            cursor: pointer;
        }
    </style>
{% endblock %}
